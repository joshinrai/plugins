function BarStacked(t,e){var i={margin:{top:20,right:20,bottom:20,left:20},xaxis:{type:"category",orient:"bottom",key:e.x||"x"},yaxis:{type:"defaults",orient:"left",key:e.y||"y",min:0}};i=_.deepMerge(i,e),this.init(t,i)}require("./bar.css");var DataV=require("../datav"),d3=require("d3"),_=require("../util");BarStacked=DataV.extend(BarStacked,{render:function(t){t&&this.data(t),this.initLayout();var e=this.options,i=this,n=e.xaxis.key,a=e.yaxis.key;this.svg.classed("bar-chart-g",!0),this._beforeRender();var r,s,o=[];t.forEach(function(t){o=_.union(o,t[a])});var d=_.max(o);e.yaxis.max=d,r=this.renderXAxis("xaxis",e.xaxis),s=this.renderYAxis("yaxis",e.yaxis);var u=r.getX(),c=s.getX(),h=t[0][a].length,f=(u.rangeBand()-(h-1)*e.padding)/h;this.series=this.svg.selectAll(".bars").data(t).enter().append("g").attr("class","bars").each(function(){var t=d3.select(this);if(e.withAnimated)for(var i=0;h>i;i++)!function(i){t.append("rect").attr({"class":"bar y"+(i+1),x:function(t){return u(t[n])+(e.padding+f)*i},y:function(){return c(s.getMin())},width:function(){return f},height:0}).transition().duration(e.animatedTiming).ease(e.animatedEasing).attr({"class":"bar y"+(i+1),x:function(t){return u(t[n])+(e.padding+f)*i},y:function(t){return c(t[a][i])},width:function(){return f},height:function(t){return c(s.getMin())-c(t[a][i])}})}(i);else for(var i=0;h>i;i++)t.append("rect").attr({"class":"bar y"+(i+1),x:function(t){return u(t[n])+(e.padding+f)*i},y:function(t){return c(t[a][i])},width:function(){return f},height:function(t){return c(s.getMin())-c(t[a][i])}})}),e.withInteract&&this.series.on("click",function(t,e){i.emit("series_click",{data:t,index:e,dom:this})}).on("mouseenter",function(t,e){i.emit("series_mouseenter",{data:t,index:e,dom:this})}).on("mouseover",function(t,e){i.emit("series_mouseover",{data:t,index:e,dom:this})}).on("mouseleave",function(t,e){i.emit("series_mouseleave",{data:t,index:e,dom:this})}),this._afterRender()},updateSeries:function(){this._updateBeforeRender();var t=this.options,e=this._com.getComs("axis"),i=e[0],n=e[1],a=_.deepMerge({},this.options,{orient:"bottom",key:t.x},t.xaxis||{}),r=[];this.data.forEach(function(e){r=_.union(r,e[t.yaxis.key])});var s=_.max(r),o=_.deepMerge({},this.options,{orient:"left",key:t.y,max:s,min:0},t.yaxis||{});i.update(a),n.update(o);var d=i.getX(),u=n.getX(),c=this.data[0][t.y].length,h=(d.rangeBand()-(c-1)*t.padding)/c;this.svg.selectAll(".bars").data(this.data),this.svg.selectAll(".bars").each(function(){for(var e=d3.select(this),i=0;c>i;i++)e.select(".y"+(i+1)).transition().duration(1500).ease("bounce").attr({x:function(e){return d(e[t.x])+(t.padding+h)*i},y:function(e){return u(e[t.y][i])},width:function(){return h},height:function(e){return u(n.getMin())-u(e[t.y][i])}})}),this._updateAfterRender()}}),module.exports=BarStacked;