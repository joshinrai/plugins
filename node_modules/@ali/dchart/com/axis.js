function Axis(i,t,n){this.reset(),this.options={key:"x",type:"defaults",orient:"bottom",dy:0,padding:.3,groupPadding:null,min:0,max:null,tickSize:1,nondecile:{key:"y",tickPadding:10},format:null},this.x,this.axisx,this.init(i,t,n),this._valid()}var _=require("../util"),Com=require("./index"),d3=require("d3");Axis=Com.extend(Axis,{_valid:function(){var i=this.options,t=["defaults","category","time","nondecile"];-1===_.indexOf(t,i.type.toLowerCase())&&(this.msg="axis arguments error. there is no "+i.type+" in types.",i.type=t[0],this.valid=!1),i.type=_.initialUpperCase(i.type);var n=["left","top","right","bottom"];-1===_.indexOf(n,i.orient.toLowerCase())&&(this.msg="axis arguments error. there is no "+i.orient+" in orients.",i.orient=n[0],this.valid=!1),i.orient=_.initialUpperCase(i.orient)},renderSeries:function(){var i=this.options;this["cal"+i.orient](),"function"==typeof i.afterRender&&i.afterRender.call(this)},format:function(){var i=this.options;if("function"==typeof i.format){var t=this;this.axisx.tickFormat(function(n,e){return i.format.call(t._data[e],n,e)})}},_afterAxis:function(){var i=this.options;"function"==typeof i._afterAxis&&i._afterAxis.call(this)},calLeft:function(){var i=this.options,t=this.alloptions,n=this.x=this["axis"+i.type].call(this,[t.innerHeight,0]),e=this.axisx=d3.svg.axis().scale(n).orient("left").tickSize(i.tickSize).tickPadding(i.dy);this.format(),this._afterAxis();this.el=this.el.append("g").attr("class","axis").call(e)},updateLeft:function(){var i=this.options,t=this.alloptions;this["updateAxis"+i.type].call(this,[t.innerHeight,0]),this._afterAxis(),this.el.call(this.axisx)},calRight:function(){var i=this.options,t=this.alloptions,n=this.x=this["axis"+i.type].call(this,[t.innerHeight,0]),e=this.axisx=d3.svg.axis().scale(n).orient("right").tickSize(i.tickSize).tickPadding(i.dy);this.format(),this._afterAxis();this.el=this.el.append("g").attr({"class":"axis",transform:"translate("+t.innerWidth+", 0)"}).call(e)},updateRight:function(){var i=this.options,t=this.alloptions;this["updateAxis"+i.type].call(this,[t.innerHeight,0]),this._afterAxis(),this.el.attr({transform:"translate("+t.innerWidth+", 0)"}).call(this.axisx)},calTop:function(){var i=this.options,t=this.alloptions,n=this.x=this["axis"+i.type].call(this,[0,t.innerWidth]),e=this.axisx=d3.svg.axis().scale(n).orient("top").tickSize(i.tickSize).tickPadding(i.dy);this.format(),this._afterAxis();this.el=this.el.append("g").attr("class","axis").call(e)},updateTop:function(){var i=this.options,t=this.alloptions;this["updateAxis"+i.type].call(this,[0,t.innerWidth]),this._afterAxis(),this.el.call(this.axisx)},calBottom:function(){var i=this.options,t=this.alloptions,n=this.x=this["axis"+i.type].call(this,[0,t.innerWidth]),e=this.axisx=d3.svg.axis().scale(n).orient("bottom").tickSize(i.tickSize).tickPadding(i.dy);this.format(),this._afterAxis();this.el=this.el.append("g").attr("class","axis").attr("transform","translate(0,"+t.innerHeight+")").call(e)},updateBottom:function(){var i=this.options,t=this.alloptions;this["updateAxis"+i.type].call(this,[0,t.innerWidth]),this._afterAxis(),this.el.attr("transform","translate(0,"+t.innerHeight+")").call(this.axisx)},axisDefaults:function(i){var t=this.x=d3.scale.linear().range(i),n=this.calExtent();return t.domain(n),t},updateAxisDefaults:function(i){return this.x.range(i),this.x.domain(this.calExtent()),this.x},axisCategory:function(i){var t,n=this.options;t=this.x=_.isArray(n.padding)?d3.scale.ordinal().rangeBands(i,n.padding[0],n.padding[1]):d3.scale.ordinal().rangeBands(i,n.padding/2,n.padding);var e=this.calExtent();return t.domain(e),t},updateAxisCategory:function(i){var t=this.options;return _.isArray(t.padding)?this.x.rangeBands(i,t.padding[0],t.padding[1]):this.x.rangeBands(i,t.padding/2,t.padding),this.x.domain(this.calExtent()),this.x},axisTime:function(i){var t,n=this.options,e=this.x=d3.time.linear().range(i);return t=_.isDate(n.min)&&_.isDate(n.max)?[n.min,n.max]:d3.extent(_.map(this._data,function(i){return i[n.key]})),e.domain(t),e},axisNondecile:function(i){var t=this.options,n=this.x=d3.scale.linear().range(i);t.max=_.sum(this._data,t.nondecile.key),n.domain(this.calExtent());var e=_.groupBy(this._data,t.key),a=this._data=[],s=0,r=a.length,o=(i[1]-i[0])/(n.domain()[1]-n.domain()[0]);for(var d in e){var h={sum:_.sum(e[d],t.nondecile.key),begin:s,end:0,center:0,radio:0};r--,h[t.key]=d,h.end=h.begin+h.sum,s+=h.sum,h.center=(h.begin+h.end)/2,t.nondecile.tickPadding&&0!==h.begin&&(h.begin=(n(h.begin)-t.nondecile.tickPadding/2-i[0])/o+n.domain()[0]),t.nondecile.tickPadding&&0!==r&&(h.end=(n(h.end)+t.nondecile.tickPadding/2-i[0])/o+n.domain()[0]),h.radio=(h.end-h.begin)/h.sum,a.push(h)}return t._afterAxis=function(){this.axisx.tickValues(_.pluck(this._data,"center")),this.el&&this.el.selectAll(".tick").data(_.pluck(this._data,"center"))},t.afterRender=function(){this.el.selectAll(".tick").data(this._data)},n},updateAxisNondecile:function(i){var t=this.options,n=this.x.range(i);t.max=_.sum(this._data,t.nondecile.key),n.domain(this.calExtent());var e=_.groupBy(this._data,t.key),a=this._data=[],s=0,r=a.length,o=(i[1]-i[0])/(n.domain()[1]-n.domain()[0]);for(var d in e){var h={sum:_.sum(e[d],t.nondecile.key),begin:s,end:0,center:0,radio:0};r--,h[t.key]=d,h.end=h.begin+h.sum,s+=h.sum,h.center=(h.begin+h.end)/2,t.nondecile.tickPadding&&0!==h.begin&&(h.begin=(n(h.begin)-t.nondecile.tickPadding/2-i[0])/o+n.domain()[0]),t.nondecile.tickPadding&&0!==r&&(h.end=(n(h.end)+t.nondecile.tickPadding/2-i[0])/o+n.domain()[0]),h.radio=(h.end-h.begin)/h.sum,a.push(h)}return n.domain(this.calExtent()),n},calExtent:function(){var i=this.options,t=[];return _.isNumber(i.min)&&_.isNumber(i.max)?t=[i.min,i.max]:"category"!==i.type.toLocaleLowerCase()?(t=d3.extent(_.map(this._data,function(t){return t[i.key]})),_.isNumber(i.min)&&(t[0]=i.min),_.isNumber(i.max)&&(t[1]=i.max)):t=_.map(this._data,function(t){return t[i.key]}),t},getX:function(){return this.x},getAxisX:function(){return this.axisx},getMin:function(){return _.first(this.x.domain())},getMax:function(){return _.last(this.x.domain())},calGroupStep:function(i){var t=this.options,n=t.groupPadding;return this.groupX=Array.isArray(n)?d3.scale.ordinal().rangeBands([0,this.x.rangeBand()],n[0]||.4,n[1]||0):d3.scale.ordinal().rangeBands([0,this.x.rangeBand()],n||8),Array.isArray(i)||(i=this._createCategory(parseInt(i))),this.groupX.domain(i),this.groupX},getGroupStep:function(i){return this.groupX?this.groupX.rangeBand():(this.calGroupStep(i),this.groupX.rangeBand())},_createCategory:function(i){for(var t=[],n=0;i>n;n++)t.push(""+n);return t},getGroupX:function(){return this.groupX||this.calGroupStep()},updateSeries:function(){var i=this.options;this["update"+i.orient](),"function"==typeof i.afterRender&&i.afterRender.call(this)}}),module.exports=Axis;