require('./line.css');
var DataV = require('../../dataV');
var d3 = require('../../libs/d3');
var _ = require('../../util');

function Line(options) {
  this._init(options);
  this._initLayout();
}

DataV.extend(Line, {
  render : function () {
    this.svg.classed('line-chart-g', true);
    this._beforeRender();
    var self = this;
    var opt = this.$options;
    var xAxis, yAxis;
    var xOpt = _.extend({
      orient : 'bottom',
      key : opt.x
    }, (opt.xaxis || {}));
    var yOpt = _.extend({
      orient : 'left',
      key : opt.y
    }, (opt.yaxis || {}));

    xAxis = this.renderAxis(xOpt);
    yAxis = this.renderAxis(yOpt);

    //真正画数据的部分
    var x = xAxis.getX();
    var y = yAxis.getX();

    var line = d3.svg.line()
      .x(function(d) { return x(d[opt.x]); })
      .y(function(d) { return y(d[opt.y]); });

    this.svg
      .datum(this._data)
      .append('path')
      .attr({
        "class": "line",
        "d": line
      });
    this._afterRender();
  }
});

module.exports = Line;