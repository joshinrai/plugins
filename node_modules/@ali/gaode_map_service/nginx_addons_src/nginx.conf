#user  nobody;
worker_processes 1;
error_log  logs/error.log debug;
#error_log  logs/error.log;
pid logs/nginx.pid;
worker_rlimit_nofile    102400;

events {
    worker_connections  102400;
}

http {
    include       mime.types;
    sendfile        on;
    keepalive_timeout  60;
    tcp_nodelay        on;
    tcp_nopush         off;

    # 影像图
    server {
        listen 0.0.0.0:8072;
        server_name pic.autonavi.com;
        access_log  logs/access.log;
        #open_file_cache max=10240 inactive=300s;

        location / {
          return 404;
        }

        # Step1: 先对url做rewrite
        location /mapservice {
      if ( $arg_c ~ "16" )
      {
      set $URL /jsontile?c=$arg_c;
      rewrite ^/(.*)$ $URL?v=$arg_v&x=$arg_x&y=$arg_y&z=$arg_z&c=$arg_c&size=$arg_size? last;
      }
      
      set $URL /maptile?v=$arg_v;
      rewrite ^/(.*)$ $URL?v=$arg_v&x=$arg_x&y=$arg_y&z=$arg_z&c=$arg_c&size=$arg_size? last;
        }

        # Step2: 到对应的数据集上查找数据
        location /jsontile?c=16 {
          merge;
          format txt;
          root /home/Danny/Data/ali/json;
        }
        location /maptile?v=blue {
          merge;
          format png;
          root /home/Danny/Data/ali/blue;
        }
        location /maptile?v=dark {
          merge;
          format png;
          root /home/Danny/Data/ali/dark;
        }
        location /maptile?v=light {
          merge;
          format png;
          root /home/Danny/Data/ali/light;
        }
    }
}