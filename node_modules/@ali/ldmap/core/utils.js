var Utils = require('@ali/map-utils');
var L = require('leaflet');
var dmap = L.dmap = L.dmap || {};
var $ = require('jquery');

function getId(type){
   var num = Math.floor(Math.random() * 10000000);
    var time = new Date().getTime();
    return type + '_' + time + '_' + num;
}

function getPt(e, node) { //获取点相对于容器的位置
    if(!node) node = $(e.target);
    node = $(node);
    var nodeW = node.width();
    var nodeH = node.height();
    var offset = node.offset();
    var left = offset.left;
    var top = offset.top;
    var x, y;
    if (e.type.indexOf('mouse') !== -1) {
      x = e.x || e.pageX;
      y = e.y || e.pageY;
      return [x - left, y - top];
    }
    var touch = window.event.touches[0];
    x = touch.pageX - left;
    y = touch.pageY - top;
    x = (x < nodeW) ? x : nodeW;
    x = (x > 0) ? x : 1;
    y = (y < nodeH) ? y : nodeH;
    y = (y > 0) ? y : 1;
    return [x, y];
  };

module.exports = dmap.Utils = Utils.merge(Utils, {
  getId: getId,
  getPt: getPt
});
